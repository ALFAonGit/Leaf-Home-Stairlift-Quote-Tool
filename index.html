<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stairlift Price Calculator by ALFA Corp</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; background-color: #f4f7f6; color: #333; margin: 0; padding: 0; }
        
        /* LOGIN SCREEN STYLES */
        #loginScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #121619; display: flex; align-items: center; justify-content: center; z-index: 9999; }
        .login-card { background: #1e272e; padding: 40px; border-radius: 12px; text-align: center; max-width: 420px; width: 90%; box-shadow: 0 15px 35px rgba(0,0,0,0.8); border: 1px solid #2c3e50; }
        .logo-img { width: 130px; height: 130px; object-fit: cover; border-radius: 50%; margin: 0 auto 15px auto; display: block; box-shadow: 0 4px 15px rgba(46, 204, 113, 0.2); border: 2px solid #2ecc71; }
        .logo-text { font-size: 28px; font-weight: 800; margin-bottom: 2px; letter-spacing: -0.5px; color: #ffffff; }
        .logo-text .blue { color: #2ecc71; }
        .subtitle { color: #95a5a6; font-size: 14px; margin-top: 0; margin-bottom: 25px; text-transform: uppercase; letter-spacing: 1px; font-weight: bold; }
        .confidential-warning { color: #e74c3c; font-size: 11px; font-weight: bold; text-transform: uppercase; margin-bottom: 25px; border-top: 1px solid #2c3e50; border-bottom: 1px solid #2c3e50; padding: 12px 0; letter-spacing: 0.5px; }
        .login-card input { width: 100%; padding: 14px; margin-bottom: 15px; border: 2px solid #34495e; border-radius: 8px; font-size: 16px; box-sizing: border-box; background-color: #2c3e50; color: white; transition: 0.3s; }
        .login-card input:focus { border-color: #2ecc71; outline: none; }
        .login-card input::placeholder { color: #7f8c8d; }
        .login-btn { width: 100%; background-color: #2ecc71; color: #121619; border: none; padding: 15px; font-size: 18px; font-weight: bold; border-radius: 8px; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 6px rgba(46, 204, 113, 0.2); }
        .login-btn:hover { background-color: #27ae60; }
        
        /* MAIN APP STYLES */
        #mainApp { display: none; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.08); }
        h1, h2, h3 { color: #2c3e50; margin-top: 0; }
        .section { margin-bottom: 25px; padding: 20px; background: #fdfefe; border: 1px solid #e1e8ed; border-radius: 8px; }
        .lift-block { border: 2px solid #34495e; background: #ffffff; position: relative; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .remove-btn { position: absolute; top: 15px; right: 15px; background: #e74c3c; color: white; border: none; padding: 8px 12px; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 13px; }
        .add-lift-btn { background-color: #2c3e50; color: white; border: none; padding: 16px; font-size: 18px; font-weight: bold; border-radius: 8px; cursor: pointer; width: 100%; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: 0.3s; }
        .add-lift-btn:hover { background-color: #1a252f; }
        label { display: block; margin-top: 12px; font-weight: 600; color: #34495e; }
        select, input[type="number"] { width: 100%; padding: 12px; margin-top: 6px; border-radius: 6px; border: 1px solid #ccd1d9; font-size: 16px; box-sizing: border-box; background-color: #f8f9fa; }
        .checkbox-group { display: flex; align-items: center; justify-content: space-between; margin-top: 10px; padding: 8px 0; border-bottom: 1px solid #f1f2f6; }
        .checkbox-group input[type="checkbox"] { width: 22px; height: 22px; margin-right: 15px; }
        .checkbox-group label { margin: 0; font-weight: normal; flex-grow: 1; }
        .qty-group { display: flex; align-items: center; justify-content: space-between; margin-top: 10px; padding: 8px 0; border-bottom: 1px solid #f1f2f6; }
        .qty-group label { margin: 0; font-weight: normal; flex-grow: 1; }
        .qty-group input[type="number"] { width: 80px; text-align: center; margin: 0; padding: 8px; }
        .totals-box { background: #f0f8ff; padding: 20px; border-radius: 8px; border-left: 5px solid #2ecc71; margin-top: 25px; }
        .totals-box h2 { margin-top: 0; color: #2c3e50; }
        .result-row { display: flex; justify-content: space-between; font-size: 18px; margin-bottom: 12px; border-bottom: 1px dashed #bdc3c7; padding-bottom: 8px; }
        .commission { font-weight: bold; color: #27ae60; font-size: 20px; }
        .finance-box { background: #fef9e7; border-left: 5px solid #f1c40f; }
        .rep-box { background: #ecf0f1; border: 1px solid #bdc3c7; margin-top: 40px; }
        hr { border: 0; height: 1px; background: #dcdde1; margin: 20px 0; }
        .hidden { display: none !important; }
        .warning { color: #c0392b; font-size: 14px; margin-top: 5px; font-weight: bold; }
        .toggle-btn { background-color: #7f8c8d; color: white; border: none; padding: 12px 15px; font-size: 16px; font-weight: bold; border-radius: 6px; cursor: pointer; width: 100%; margin-top: 10px; }
        .sub-text { font-size: 14px; color: #555; border-bottom: none; margin-bottom: 4px; padding-bottom: 0; }
        .breakdown-row { font-size: 15px; color: #2c3e50; display: flex; justify-content: space-between; margin-top: 8px; padding-left: 10px; border-left: 3px solid #2ecc71; }
    </style>
</head>
<body>

<div id="loginScreen">
    <div class="login-card">
        <img src="image.WEBP" alt="ALFA Corp Logo" class="logo-img" onerror="this.style.display='none'">
        <div class="logo-text">Stairlift <span class="blue">Price Calculator</span></div>
        <p class="subtitle">by ALFA Corp</p>
        
        <div class="confidential-warning">
            Proprietary Sales Tool.<br>Authorized Personnel Only.
        </div>
        
        <input type="text" id="usernameInput" placeholder="Rep Username">
        <input type="password" id="passwordInput" placeholder="Password">
        <button class="login-btn" onclick="checkLogin()">SECURE LOGIN</button>
        <p id="loginError" style="color: #e74c3c; font-weight: bold; display: none; margin-top: 15px;">Invalid Username or Password</p>
    </div>
</div>

<div id="mainApp">
    <div class="container">
        <div style="text-align: center; margin-bottom: 25px; border-bottom: 2px solid #ecf0f1; padding-bottom: 15px;">
            <h1 style="color: #2c3e50; font-size: 28px; margin-bottom: 5px;">Stairlift Price Calculator</h1>
            <p style="margin: 0; color: #7f8c8d; font-size: 14px; font-weight: bold; text-transform: uppercase;">by ALFA Corp</p>
        </div>

        <div id="lifts-container"></div>
        
        <button class="add-lift-btn" onclick="addLift()">➕ Add Another Lift</button>

        <div class="section" style="background: #eef2f5; border-color: #d5dce3;">
            <h2 style="color: #2980b9;">Global Project Adjustments</h2>
            
            <label style="color: #2c3e50;">Retail Price Modifier (add-on %):</label>
            <input type="number" id="globalFluffPercent" value="0" min="0" max="100" oninput="calculate()" placeholder="e.g., 10">

            <label style="color: #2c3e50; margin-top: 15px;">Project Discount %:</label>
            <input type="number" id="globalDiscountPercent" value="0" min="0" max="40" oninput="calculate()" placeholder="e.g., 15">

            <label style="margin-top: 15px;">Select Payment Method:</label>
            <select id="paymentMethod" onchange="togglePaymentMethod(); calculate()">
                <option value="check">Check / ACH / Cash (0% Fee)</option>
                <option value="cc">Standard Credit Card (3% Fee)</option>
                <option value="amex">American Express (5% Fee)</option>
                <option value="finance">Financing (Fees vary by plan)</option>
            </select>

            <label style="margin-top: 15px;">Required Deposit (%):</label>
            <select id="downPaymentPercent" onchange="calculate()">
                <option value="0.10">10% (Standard)</option>
                <option value="0.25">25% (Helix Custom Curve / Forced)</option>
            </select>
            
            <label>Custom Flat Deposit ($) - Overrides %:</label>
            <input type="number" id="downPaymentFlat" value="" min="0" oninput="calculate()" placeholder="Enter custom amount">
        </div>

        <div class="section totals-box">
            <h2>Price Breakdown</h2>
            <div class="result-row"><span>RETAIL PRICE (Good for 1 year):</span> <span id="displayShowPrice">$0.00</span></div>
            <div class="result-row"><span>TODAY'S PRICE (Initial Offer):</span> <span id="displayRetailPrice">$0.00</span></div>
            <div class="result-row" style="color: #27ae60;"><span>DISCOUNT (<span id="displayDiscountPercent">0%</span>):</span> <span id="displayDiscountAmount">-$0.00</span></div>
            
            <div class="result-row" id="processingFeeRow" style="display: none; color: #e67e22;">
                <span>PROCESSING FEE (<span id="displayFeePercent">0%</span>):</span> 
                <span id="displayFeeAmount">+$0.00</span>
            </div>

            <div class="result-row" style="font-weight: bold; color: #c0392b; margin-top: 15px;"><span>FINAL TOTAL PRICE:</span> <span id="displayFinalPrice">$0.00</span></div>
            <div style="font-size: 12px; color: #7f8c8d; text-align: right; margin-top: -5px; margin-bottom: 10px;">*Includes standard $500 Contract Admin Fee</div>
            
            <hr>
            <div class="result-row" style="margin-top: 15px;"><span>AMOUNT DUE TODAY:</span> <span id="displayDue">$0.00</span></div>
            <div class="result-row"><span>REMAINING BALANCE:</span> <span id="displayBalance">$0.00</span></div>
        </div>

        <div id="financeSection" class="section totals-box finance-box hidden">
            <h2>Financing Options</h2>
            <label>Select Finance Plan:</label>
            <select id="financePlan" onchange="calculate()">
                <option value="-1" data-fee="0">-- Select a Plan --</option>
                
                <optgroup label="WELLS FARGO: No Interest w/ Reg Payments">
                    <option value="0.035" data-fee="0.0175">Plan 1148: 6 Mos No Int (3.5% Min Pymt, 1.75% Fee)</option>
                    <option value="0.035" data-fee="0.0375">Plan 1019: 12 Mos No Int (3.5% Min Pymt, 3.75% Fee)</option>
                </optgroup>

                <optgroup label="WELLS FARGO: Reduced Rate & Special APR">
                    <option value="0.02" data-fee="0.0675">Plan 1157: 6.9% APR (2.0% Min Pymt, 6.75% Fee)</option>
                    <option value="0.035" data-fee="0.0525">Plan 1197: 9.99% APR (3.5% Min Pymt, 5.25% Fee)</option>
                    <option value="0.0215" data-fee="0.0400">Plan 2225: 12.9% APR (2.15% Min Pymt, 4.00% Fee)</option>
                    <option value="0.019462" data-fee="0.1100">Plan 3198: 60 Mos @ 5.99% (1.94% PF, 11.00% Fee)</option>
                    <option value="0.016156" data-fee="0.0495">Plan 1529: 84 Mos @ 8.99% (1.61% PF, 4.95% Fee)</option>
                </optgroup>

                <optgroup label="WELLS FARGO: 0% Interest Equal Payments">
                    <option value="0.055555" data-fee="0.0950">Plan 4073: 18 Mos 0% Equal Pymts (9.50% Fee)</option>
                    <option value="0.041666" data-fee="0.1100">Plan 4079: 24 Mos 0% Equal Pymts (11.00% Fee)</option>
                    <option value="0.027777" data-fee="0.1300">Plan 4091: 36 Mos 0% Equal Pymts (13.00% Fee)</option>
                    <option value="0.020833" data-fee="0.1625">Plan 4103: 48 Mos 0% Equal Pymts (16.25% Fee)</option>
                    <option value="0.016666" data-fee="0.1875">Plan 4115: 60 Mos 0% Equal Pymts (18.75% Fee)</option>
                </optgroup>

                <optgroup label="SERVICE FINANCE: Deferred Int / Min Pymts">
                    <option value="0.01" data-fee="0.0375">Plan 1006: 6 Mos Def. Int w/ Min Pymt (3.75% Fee)</option>
                    <option value="0.01" data-fee="0.0500">Plan 1012: 12 Mos Def. Int w/ Min Pymt (5.00% Fee)</option>
                    <option value="0.01" data-fee="0.0550">Plan 1018: 18 Mos Def. Int w/ Min Pymt (5.50% Fee)</option>
                    <option value="0.01" data-fee="0.0775">Plan 1024: 24 Mos Def. Int w/ Min Pymt (7.75% Fee)</option>
                </optgroup>
                
                <optgroup label="SERVICE FINANCE: Same As Cash (No Pymts)">
                    <option value="0" data-fee="0.0375">Plan 2003: 3 Mos SAC (3.75% Fee)</option>
                    <option value="0" data-fee="0.0400">Plan 2006: 6 Mos SAC (4.00% Fee)</option>
                    <option value="0" data-fee="0.0550">Plan 2012: 12 Mos SAC (5.50% Fee)</option>
                    <option value="0" data-fee="0.0875">Plan 2018: 18 Mos SAC (8.75% Fee)</option>
                    <option value="0" data-fee="0.1250">Plan 2024: 24 Mos SAC (12.50% Fee)</option>
                </optgroup>
                
                <optgroup label="SERVICE FINANCE: Equal Monthly Pymts (Zero Int)">
                    <option value="0.040000" data-fee="0.0925">Plan 3025: 25 Mos Equal Pymts (9.25% Fee)</option>
                    <option value="0.027777" data-fee="0.1300">Plan 3036: 36 Mos Equal Pymts (13.00% Fee)</option>
                    <option value="0.020833" data-fee="0.1400">Plan 3048: 48 Mos Equal Pymts (14.00% Fee)</option>
                    <option value="0.016666" data-fee="0.1500">Plan 3060: 60 Mos Equal Pymts (15.00% Fee)</option>
                    <option value="0.013888" data-fee="0.1800">Plan 3072: 72 Mos Equal Pymts (18.00% Fee)</option>
                </optgroup>
                
                <optgroup label="SERVICE FINANCE: Reduced Interest Loans">
                    <option value="0.0082" data-fee="0.2100">Plan 4082: 144 Mos @ 2.99% (0.82% PF, 21.00% Fee)</option>
                    <option value="0.0092" data-fee="0.0975">Plan 4092: 144 Mos @ 4.99% (0.92% PF, 9.75% Fee)</option>
                    <option value="0.0071" data-fee="0.1700">Plan 4071: 240 Mos @ 5.99% (0.71% PF, 17.00% Fee)</option>
                    <option value="0.0198" data-fee="0.0500">Plan 4198: 60 Mos @ 6.99% (1.98% PF, 5.00% Fee)</option>
                    <option value="0.0116" data-fee="0.0500">Plan 4116: 120 Mos @ 6.99% (1.16% PF, 5.00% Fee)</option>
                    <option value="0.0102" data-fee="0.0650">Plan 4102: 144 Mos @ 6.99% (1.02% PF, 6.50% Fee)</option>
                    <option value="0.0089" data-fee="0.0650">Plan 4089: 180 Mos @ 6.99% (0.89% PF, 6.50% Fee)</option>
                    <option value="0.0202" data-fee="0.0300">Plan 4202: 60 Mos @ 7.99% (2.02% PF, 3.00% Fee)</option>
                    <option value="0.0121" data-fee="0.0300">Plan 4121: 120 Mos @ 7.99% (1.21% PF, 3.00% Fee)</option>
                    <option value="0.0108" data-fee="0.0300">Plan 4108: 144 Mos @ 7.99% (1.08% PF, 3.00% Fee)</option>
                    <option value="0.0096" data-fee="0.0300">Plan 4096: 180 Mos @ 7.99% (0.96% PF, 3.00% Fee)</option>
                    <option value="0.0212" data-fee="0.0400">Plan 4212: 60 Mos @ 9.99% (2.12% PF, 4.00% Fee)</option>
                    <option value="0.0165" data-fee="0.0490">Plan 4165: 85 Mos @ 9.99% (1.65% PF, 4.90% Fee)</option>
                    <option value="0.0158" data-fee="0.0350">Plan 4158: 90 Mos @ 9.99% (1.58% PF, 3.50% Fee)</option>
                    <option value="0.0150" data-fee="0.0550">Plan 4150: 97 Mos @ 9.99% (1.50% PF, 5.50% Fee)</option>
                    <option value="0.0132" data-fee="0.0000">Plan 4132: 120 Mos @ 9.99% (1.32% PF, 0% Fee)</option>
                    <option value="0.0119" data-fee="0.0200">Plan 4119: 144 Mos @ 9.99% (1.19% PF, 2.00% Fee)</option>
                    <option value="0.0107" data-fee="0.0200">Plan 4107: 180 Mos @ 9.99% (1.07% PF, 2.00% Fee)</option>
                    <option value="0.0176" data-fee="0.0200">Plan 4011: 84 Mos @ 11.99% (1.76% PF, 2.00% Fee)</option>
                    <option value="0.0181" data-fee="0.0000">Plan 4012: 84 Mos @ 12.99% (1.81% PF, 0% Fee)</option>
                </optgroup>

                <optgroup label="SERVICE FINANCE: Hybrid Loans (Deferred Pymts)">
                    <option value="0.0198" data-fee="0.0550">Plan 4398: 3 Mos NINP + 60 Mos @ 6.99% (1.98% PF, 5.50% Fee)</option>
                    <option value="0.0116" data-fee="0.0550">Plan 4316: 3 Mos NINP + 120 Mos @ 6.99% (1.16% PF, 5.50% Fee)</option>
                    <option value="0.0212" data-fee="0.0150">Plan 4312: 3 Mos NINP + 60 Mos @ 9.99% (2.12% PF, 1.50% Fee)</option>
                    <option value="0.0132" data-fee="0.0200">Plan 4332: 3 Mos NINP + 120 Mos @ 9.99% (1.32% PF, 2.00% Fee)</option>
                    <option value="0.0212" data-fee="0.0350">Plan 4612: 6 Mos NINP + 60 Mos @ 9.99% (2.12% PF, 3.50% Fee)</option>
                    <option value="0.0132" data-fee="0.0500">Plan 4632: 6 Mos NINP + 120 Mos @ 9.99% (1.32% PF, 5.00% Fee)</option>
                </optgroup>
                
                <optgroup label="SERVICE FINANCE: Buy Deeper Loan Options">
                    <option value="0.01" data-fee="0.0000">Buy Deeper: 6 Month WPDI-580 FICO @ 11.95% (Standard Fee)</option>
                    <option value="0.0138" data-fee="0.1200">Buy Deeper: 120 Mos @ 10.99% (1.38% PF, 12.00% Fee)</option>
                    <option value="0.0171" data-fee="0.1400">Buy Deeper: 84 Mos @ 10.99% (1.71% PF, 14.00% Fee)</option>
                </optgroup>

                <optgroup label="FOUNDATION FINANCE: Revolving">
                    <option value="0.0200" data-fee="0.0000">Standard Rate: 17.99% (2.00% PF, Free)</option>
                    <option value="0.0150" data-fee="0.0250">Buy-down 10.9-13.5% (1.50% PF, Varies - e.g. 2.5%)</option>
                    <option value="0.0125" data-fee="0.0500">Buy-down 9.9% (1.25% PF, Varies - e.g. 5.0%)</option>
                </optgroup>
                
                <optgroup label="WELLS FARGO: High Minimum ($7,500+) - NOT APPLICABLE">
                    <option disabled value="0.014187" data-fee="0.0780">Plan 3672: 96 Mos @ 7.99% (Greyed Out - N/A for Stairlifts)</option>
                    <option disabled value="0.013059" data-fee="0.0830">Plan 3667: 108 Mos @ 7.99% (Greyed Out - N/A for Stairlifts)</option>
                    <option disabled value="0.012166" data-fee="0.0880">Plan 3668: 120 Mos @ 7.99% (Greyed Out - N/A for Stairlifts)</option>
                    <option disabled value="0.015228" data-fee="0.0570">Plan 3669: 96 Mos @ 9.99% (Greyed Out - N/A for Stairlifts)</option>
                    <option disabled value="0.014122" data-fee="0.0620">Plan 3670: 108 Mos @ 9.99% (Greyed Out - N/A for Stairlifts)</option>
                    <option disabled value="0.013252" data-fee="0.0670">Plan 3671: 120 Mos @ 9.99% (Greyed Out - N/A for Stairlifts)</option>
                </optgroup>
            </select>
            
            <div class="result-row sub-text" style="margin-top: 15px;"><span>Base Balance:</span> <span id="displayBaseBalance">$0.00</span></div>
            <div class="result-row sub-text"><span>Finance Fee Added:</span> <span id="displayFinanceFee">$0.00</span></div>
            <div class="result-row sub-text" style="font-weight: bold;"><span>Total Financed Amount:</span> <span id="displayTotalFinanced">$0.00</span></div>
            
            <div class="result-row" style="margin-top: 15px; font-weight: bold; font-size: 20px; color: #2c3e50;"><span>EST. MONTHLY PAYMENT:</span> <span id="displayMonthly">$0.00</span></div>
        </div>

        <div class="section rep-box">
            <button class="toggle-btn" id="toggleCommBtn" onclick="toggleCommission()">For Sales Rep Use ONLY</button>
            <div id="commissionContainer" class="hidden" style="margin-top: 15px;">
                <h3 style="margin-top: 0; color: #2c3e50; border-bottom: 2px solid #bdc3c7; padding-bottom: 5px;">Commission Breakdown</h3>
                
                <div class="result-row sub-text"><span>Project Discount %:</span> <span id="displayGlobalRepDiscount" style="font-weight: bold;">0%</span></div>
                <div class="result-row sub-text"><span>Commission Tier Earned:</span> <span id="displayCommTier" style="font-weight: bold; color: #2980b9;">12% Max Tier</span></div>
                
                <div id="commBreakdownContainer" class="hidden" style="margin-top: 15px; padding-top: 10px; border-top: 1px dashed #bdc3c7;">
                    <div style="font-size: 13px; font-weight: bold; color: #7f8c8d; text-transform: uppercase; margin-bottom: 5px;">Per-Lift Detail:</div>
                    <div id="commBreakdownList"></div>
                </div>

                <div class="result-row commission" style="margin-top: 20px; border-top: 2px solid #27ae60; padding-top: 10px;">
                    <span>FINAL PAYOUT:</span> <span id="displayCommission">$0.00</span>
                </div>
                
                <div style="font-size: 13px; color: #7f8c8d; margin-top: 10px;">*Commission is strictly based on Base minus Discount. Global Admin fees and Finance Dealer fees are completely excluded from this calculation.</div>
            </div>
        </div>

    </div>
</div>

<template id="lift-template">
    <div class="lift-block">
        <button class="remove-btn" onclick="removeLift(this)">X Remove Lift</button>
        <h2 class="lift-title" style="color: #2c3e50; border-bottom: 1px solid #ccc; padding-bottom: 5px;">Lift 1</h2>
        
        <label>Select Lift Category:</label>
        <select class="lift-category" onchange="updateCategory(this); calculate();">
            <option value="none">-- Select Category --</option>
            <option value="straight">Straight Indoor Lifts</option>
            <option value="helix">Custom Curved Lifts (Helix)</option>
            <option value="uplift">Curved Lifts (Uplift)</option>
            <option value="outdoor">Outdoor Comfort Lifts</option>
        </select>

        <div class="cat-straight category-group hidden">
            <label>Select Base Lift:</label>
            <select class="base-lift" onchange="calculate()">
                <option value="0">-- Select --</option>
                <option value="7697">Comfort Leaf Lift 350 lbs - $7,697</option>
                <option value="10523">Comfort Leaf Lift w/ Folding Rail 350 lbs - $10,523</option>
                <option value="14984">SL600HD Bariatric 600 lbs (No Folding) - $14,984</option>
            </select>
            
            <label>Rail Add-ons:</label>
            <select class="straight-rail" onchange="calculate()">
                <option value="0">Included (Up to 16')</option>
                <option value="511">3' railing add-on - $511</option>
                <option value="850">5' railing add-on - $850</option>
                <option value="1358">8' railing add-on - $1,358</option>
            </select>

            <label>Hardware & Electrical:</label>
            <div class="qty-group"><label>Chrome 16" or 24" Grab Bars ($350 ea)</label><input type="number" class="grab-bar-qty" value="0" min="0" oninput="calculate()"></div>
            <div class="qty-group"><label>Grab Bar Finish Upgrade ($124 ea)</label><input type="number" class="finish-upgrade-qty" value="0" min="0" oninput="calculate()"></div>
            <div class="checkbox-group"><label>Interior Outlet ($396)</label><input type="checkbox" class="addon-cb" value="396" onchange="calculate()"></div>
            <div class="checkbox-group"><label>Low Voltage 8' Cord Add-on ($175)</label><input type="checkbox" class="addon-cb" value="175" onchange="calculate()"></div>
        </div>

        <div class="cat-helix category-group hidden">
            <div class="warning">⚠️ Helix Lifts ALWAYS require a 25% minimum deposit.</div>
            <label>Select Base Lift:</label>
            <select class="base-lift" onchange="calculate()">
                <option value="0">-- Select --</option>
                <option value="29769">CSL500 Helix (All turns, up to 24') - $29,769</option>
                <option value="21698">CSL580-18 Helix (18', 1x180° turn) - $21,698</option>
                <option value="24281">CSL580-24 Helix (24', 1x180° turn) - $24,281</option>
                <option value="20982">CSL590-18 Helix (18', 1x90° turn) - $20,982</option>
                <option value="23565">CSL590-24 Helix (24', 1x90° turn) - $23,565</option>
                <option value="34710">CSL-570 Sweeping Curve (up to 24') - $34,710</option>
            </select>

            <label>Hardware Add-ons:</label>
            <div class="qty-group"><label>Linear Ft Rail Add-on above 24' ($454/ft)</label><input type="number" class="helix-rail-ft" value="0" min="0" oninput="calculate()"></div>
            <div class="qty-group"><label>Custom Park 90° or 180° ($6,250 ea)</label><input type="number" class="helix-park-qty" value="0" min="0" oninput="calculate()"></div>
            <div class="checkbox-group"><label>Add-on Charging Station for Mid Landing ($1,450)</label><input type="checkbox" class="addon-cb" value="1450" onchange="calculate()"></div>
            <div class="checkbox-group"><label>Interior Outlet ($396)</label><input type="checkbox" class="addon-cb" value="396" onchange="calculate()"></div>
        </div>

        <div class="cat-uplift category-group hidden">
            <div class="warning">⚠️ Uplift maximum weight capacity is 250 lbs.</div>
            <label>Select Base Lift:</label>
            <select class="base-lift" onchange="calculate()">
                <option value="0">-- Select --</option>
                <option value="29769">Uplift 360 Degree Pkg (27' incl) - $29,769</option>
                <option value="23565">Uplift 180 Degree Pkg (24' incl) - $23,565</option>
            </select>

            <label>Hardware Add-ons:</label>
            <div class="qty-group"><label>Additional Linear Footage ($250/ft)</label><input type="number" class="uplift-rail-ft" value="0" min="0" oninput="calculate()"></div>
            <div class="qty-group"><label>Add 180° Park or Turn ($6,250 ea)</label><input type="number" class="uplift-180-qty" value="0" min="0" oninput="calculate()"></div>
            <div class="qty-group"><label>Add 90° Park or Turn ($3,125 ea)</label><input type="number" class="uplift-90-qty" value="0" min="0" oninput="calculate()"></div>
            <div class="checkbox-group"><label>Uplift Folding Rail Add-on ($3,350)</label><input type="checkbox" class="addon-cb" value="3350" onchange="calculate()"></div>
            <div class="checkbox-group"><label>Add-on Charging Station for Mid Landing ($1,450)</label><input type="checkbox" class="addon-cb" value="1450" onchange="calculate()"></div>
            <div class="checkbox-group"><label>Interior Outlet ($396)</label><input type="checkbox" class="addon-cb" value="396" onchange="calculate()"></div>
        </div>

        <div class="cat-outdoor category-group hidden">
            <label>Select Base Lift:</label>
            <select class="base-lift" onchange="calculate()">
                <option value="0">-- Select --</option>
                <option value="15681">Outdoor Comfort Lift (Up to 16' max) - $15,681</option>
                <option value="18047">Outdoor Comfort Lift (16'1" to 24' max) - $18,047</option>
            </select>

            <label>Hardware & Labor Add-ons:</label>
            <div class="qty-group"><label>Burial Charge for Elec. Lines ($370 per 20ft)</label><input type="number" class="burial-qty" value="0" min="0" oninput="calculate()"></div>
            <div class="qty-group"><label>Additional Labor ($95/hour)</label><input type="number" class="labor-qty" value="0" min="0" oninput="calculate()"></div>
            <div class="checkbox-group"><label>Add Outdoor Outlet ($625)</label><input type="checkbox" class="addon-cb" value="625" onchange="calculate()"></div>
        </div>

        <div class="universal-addons category-group hidden" style="margin-top: 20px; border-top: 2px solid #ccc; padding-top: 15px;">
            <div class="checkbox-group"><label><strong>Remove Existing Lift & Dispose ($389)</strong></label><input type="checkbox" class="universal-removal" value="389" onchange="calculate()"></div>
        </div>
    </div>
</template>

<script>
    let liftCounter = 0;

    // LOGIN LOGIC
    function checkLogin() {
        const user = document.getElementById('usernameInput').value;
        const pass = document.getElementById('passwordInput').value;
        const errorMsg = document.getElementById('loginError');
        
        if (user === 'LHSSREP' && pass === 'Leafhome2026!') {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            if (liftCounter === 0) addLift(); // Initialize first lift on successful login
        } else {
            errorMsg.style.display = 'block';
        }
    }

    // TOGGLE PAYMENT METHOD (SHOW/HIDE FINANCING)
    function togglePaymentMethod() {
        const method = document.getElementById('paymentMethod').value;
        const financeSection = document.getElementById('financeSection');
        if (method === 'finance') {
            financeSection.classList.remove('hidden');
        } else {
            financeSection.classList.add('hidden');
            document.getElementById('financePlan').value = "-1"; // Auto-reset finance dropdown if they switch back to cash/cc
        }
    }

    // MULTI-LIFT LOGIC
    function addLift() {
        liftCounter++;
        const template = document.getElementById('lift-template');
        const clone = template.content.cloneNode(true);
        
        clone.querySelector('.lift-title').innerText = "LIFT " + liftCounter;
        
        document.getElementById('lifts-container').appendChild(clone);
        updateLiftUI();
        calculate();
    }

    function removeLift(btn) {
        btn.closest('.lift-block').remove();
        updateLiftUI();
        calculate();
    }

    function updateLiftUI() {
        const blocks = document.querySelectorAll('#lifts-container .lift-block');
        liftCounter = blocks.length;
        
        blocks.forEach((block, index) => {
            block.querySelector('.lift-title').innerText = "LIFT " + (index + 1);
            const removeBtn = block.querySelector('.remove-btn');
            // Hide remove button if it's the only lift on screen
            if (blocks.length === 1) {
                removeBtn.style.display = 'none';
            } else {
                removeBtn.style.display = 'block';
            }
        });
    }

    function updateCategory(selectElement) {
        const block = selectElement.closest('.lift-block');
        const cat = selectElement.value;
        
        // Hide all build sections inside this specific lift block
        block.querySelectorAll('.category-group').forEach(el => el.classList.add('hidden'));
        
        // Reset inputs inside this block
        block.querySelectorAll('.base-lift, .straight-rail').forEach(el => el.value = "0");
        block.querySelectorAll('input[type="number"]').forEach(el => el.value = "0");
        block.querySelectorAll('input[type="checkbox"]').forEach(el => el.checked = false);
        
        // Show selected section inside this block
        if (cat !== 'none') {
            block.querySelector('.cat-' + cat).classList.remove('hidden');
            block.querySelector('.universal-addons').classList.remove('hidden');
        }
    }

    function toggleCommission() {
        const commDiv = document.getElementById('commissionContainer');
        const btn = document.getElementById('toggleCommBtn');
        if (commDiv.classList.contains('hidden')) {
            commDiv.classList.remove('hidden');
            btn.innerText = "Hide Rep Section";
        } else {
            commDiv.classList.add('hidden');
            btn.innerText = "For Sales Rep Use ONLY";
        }
    }

    function calculate() {
        let grandRetailBase = 0;
        let grandFinalBase = 0;
        
        let hasHelix = false;
        let hasUplift = false;
        
        let liftsData = [];

        // Formatting function
        const formatMoney = (num) => '$' + num.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});

        // Get Global Modifiers
        let globalFluffRate = (parseFloat(document.getElementById('globalFluffPercent').value) || 0) / 100;
        let globalDiscountRate = (parseFloat(document.getElementById('globalDiscountPercent').value) || 0) / 100;

        // Loop 1: Gather all base math for every single lift
        document.querySelectorAll('#lifts-container .lift-block').forEach((block, index) => {
            const cat = block.querySelector('.lift-category').value;
            if (cat === 'none') return;

            let liftRetailBase = 0;
            const activeContainer = block.querySelector('.cat-' + cat);

            // Get base price for this lift
            liftRetailBase += parseFloat(activeContainer.querySelector('.base-lift').value) || 0;
            
            // Add checkboxes for this lift
            activeContainer.querySelectorAll('.addon-cb:checked').forEach(cb => {
                liftRetailBase += parseFloat(cb.value);
            });
            
            // Add Universal Removal if checked for this lift
            if (block.querySelector('.universal-removal').checked) liftRetailBase += 389;

            // Add Category-Specific Multipliers
            if (cat === 'straight') {
                liftRetailBase += parseFloat(activeContainer.querySelector('.straight-rail').value) || 0;
                liftRetailBase += (parseFloat(activeContainer.querySelector('.grab-bar-qty').value) || 0) * 350;
                liftRetailBase += (parseFloat(activeContainer.querySelector('.finish-upgrade-qty').value) || 0) * 124;
            } 
            else if (cat === 'helix') {
                hasHelix = true;
                liftRetailBase += (parseFloat(activeContainer.querySelector('.helix-rail-ft').value) || 0) * 454;
                liftRetailBase += (parseFloat(activeContainer.querySelector('.helix-park-qty').value) || 0) * 6250;
            }
            else if (cat === 'uplift') {
                hasUplift = true;
                liftRetailBase += (parseFloat(activeContainer.querySelector('.uplift-rail-ft').value) || 0) * 250;
                liftRetailBase += (parseFloat(activeContainer.querySelector('.uplift-180-qty').value) || 0) * 6250;
                liftRetailBase += (parseFloat(activeContainer.querySelector('.uplift-90-qty').value) || 0) * 3125;
            }
            else if (cat === 'outdoor') {
                liftRetailBase += (parseFloat(activeContainer.querySelector('.burial-qty').value) || 0) * 370;
                liftRetailBase += (parseFloat(activeContainer.querySelector('.labor-qty').value) || 0) * 95;
            }

            // Price Adjustments for THIS lift applying global discount
            let liftFinalPrice = liftRetailBase * (1 - globalDiscountRate);

            // Save pure commissionable data for Step 2
            liftsData.push({
                name: "LIFT " + (index + 1),
                retail: liftRetailBase,
                final: liftFinalPrice
            });

            // Add to Grand Totals
            grandRetailBase += liftRetailBase;
            grandFinalBase += liftFinalPrice;
        });

        // ----------------- GLOBAL MATH & COMMISSION ----------------- //
        
        // $500 Admin Fee is applied ONCE per contract (Strictly excluded from commission base)
        const globalAdminFee = grandRetailBase > 0 ? 500 : 0;
        
        // Subtotals Before Payment Processing Fees
        let subtotalRetail = grandRetailBase > 0 ? grandRetailBase + globalAdminFee : 0;
        let subtotalFinalPrice = grandFinalBase > 0 ? grandFinalBase + globalAdminFee : 0;

        // Payment Processing Fee Logic
        let paymentMethod = document.getElementById('paymentMethod').value;
        let paymentFeeRate = 0;
        
        if (paymentMethod === 'cc') paymentFeeRate = 0.03;
        if (paymentMethod === 'amex') paymentFeeRate = 0.05;

        // Calculate actual processing fee dollar amounts based on the total discounted cost (including admin fee)
        let paymentFeeAmountFinal = subtotalFinalPrice * paymentFeeRate;
        let paymentFeeAmountRetail = subtotalRetail * paymentFeeRate;

        // Final actual cost and Today's baseline price
        let totalFinalPrice = subtotalFinalPrice + paymentFeeAmountFinal;
        let todaysPrice = subtotalRetail + paymentFeeAmountRetail;

        // Discount Math
        let totalDiscountAmount = grandRetailBase - grandFinalBase;
        let effectiveDiscountPercent = grandRetailBase > 0 ? (totalDiscountAmount / grandRetailBase) * 100 : 0;

        // --- Fluff (Retail Add-On) Logic ---
        // Simulate Finance Fee for the completely un-discounted price to accurately inflate the "Retail Price"
        let financeSelect = document.getElementById('financePlan');
        let selectedOption = financeSelect.options[financeSelect.selectedIndex];
        let pfRate = parseFloat(selectedOption.value) || 0;
        let dealerFeeRate = parseFloat(selectedOption.getAttribute('data-fee')) || 0;

        let dpPercent = parseFloat(document.getElementById('downPaymentPercent').value) || 0.10;
        if (hasHelix) dpPercent = 0.25;
        let dpFlat = parseFloat(document.getElementById('downPaymentFlat').value) || 0;
        
        let simulatedDpAmount = dpFlat > 0 ? dpFlat : (todaysPrice * dpPercent);
        let simulatedBalance = todaysPrice - simulatedDpAmount;
        if (simulatedBalance < 0) simulatedBalance = 0;
        
        let simulatedFinanceFee = (paymentMethod === 'finance') ? (simulatedBalance * dealerFeeRate) : 0;

        // Fluff applies to the absolute maximum total cost of the job (Base + Admin + CC/Finance Fee)
        let absoluteTotalCostToday = todaysPrice + simulatedFinanceFee;
        let fluffedRetailPrice = absoluteTotalCostToday * (1 + globalFluffRate);
        // -----------------------------------

        // Determine Global Commission Tier based on the overall effective discount
        let tierRate = 0;
        let tierText = "";
        let isFlat = false;

        if (grandRetailBase > 0) {
            if (effectiveDiscountPercent <= 10.01) { tierRate = 0.12; tierText = "12%"; }
            else if (effectiveDiscountPercent <= 15.01) { tierRate = 0.10; tierText = "10%"; }
            else if (effectiveDiscountPercent <= 20.01) { tierRate = 0.08; tierText = "8%"; }
            else if (effectiveDiscountPercent <= 25.01) { tierRate = 0.05; tierText = "5% (PAR)"; }
            else if (effectiveDiscountPercent <= 40.01) { isFlat = true; tierText = "Flat $200 (Per Lift)"; }
            else { tierRate = 0; tierText = "0% (Max discount exceeded)"; }
        }

        // Loop 2: Calculate Master Commission (Excluding Admin & Finance/CC Fees)
        let masterCommission = 0;
        let breakdownHTML = "";

        liftsData.forEach(lift => {
            let liftComm = 0;
            if (lift.retail > 0) {
                if (isFlat) liftComm = 200;
                else if (tierRate > 0) liftComm = lift.final * tierRate;
            }
            masterCommission += liftComm;

            // Build visual breakdown row
            breakdownHTML += `<div class="breakdown-row"><span>${lift.name} Payout:</span> <span style="font-weight: bold; color: #27ae60;">${formatMoney(liftComm)}</span></div>`;
        });

        // Update Rep Only UI Elements
        document.getElementById('displayGlobalRepDiscount').innerText = parseFloat(effectiveDiscountPercent.toFixed(1)) + "%";
        document.getElementById('displayCommTier').innerText = tierText;
        document.getElementById('displayCommission').innerText = grandRetailBase > 0 ? formatMoney(masterCommission) : "$0.00";
        
        const breakdownContainer = document.getElementById('commBreakdownContainer');
        if (liftsData.length > 1 && grandRetailBase > 0) {
            document.getElementById('commBreakdownList').innerHTML = breakdownHTML;
            breakdownContainer.classList.remove('hidden');
        } else {
            breakdownContainer.classList.add('hidden');
        }

        // Actual Final Down Payment Math
        let amountDue = dpFlat > 0 ? dpFlat : (totalFinalPrice * dpPercent);
        if (hasUplift && dpFlat === 0 && amountDue > 0 && amountDue < 1000) {
            amountDue = 1000;
        }

        let balance = grandRetailBase === 0 ? 0 : totalFinalPrice - amountDue;
        if (balance < 0) balance = 0; 

        // Actual Final Finance Math
        let financeFeeAmount = balance * dealerFeeRate;
        let totalFinancedAmount = balance + financeFeeAmount;
        let monthly = totalFinancedAmount * pfRate;
        
        // Update Customer Presentation UI Elements
        document.getElementById('displayShowPrice').innerText = grandRetailBase > 0 ? formatMoney(fluffedRetailPrice) : "$0.00";
        document.getElementById('displayRetailPrice').innerText = grandRetailBase > 0 ? formatMoney(todaysPrice) : "$0.00";
        document.getElementById('displayDiscountPercent').innerText = grandRetailBase > 0 ? parseFloat(effectiveDiscountPercent.toFixed(1)) + "%" : "0%";
        document.getElementById('displayDiscountAmount').innerText = grandRetailBase > 0 ? "-" + formatMoney(totalDiscountAmount) : "-$0.00";
        
        // Handle Payment Processing Fee Display
        const feeRow = document.getElementById('processingFeeRow');
        if (paymentFeeRate > 0 && grandRetailBase > 0) {
            feeRow.style.display = 'flex';
            document.getElementById('displayFeePercent').innerText = (paymentFeeRate * 100) + "%";
            document.getElementById('displayFeeAmount').innerText = "+" + formatMoney(paymentFeeAmountFinal);
        } else {
            feeRow.style.display = 'none';
            document.getElementById('displayFeePercent').innerText = "0%";
            document.getElementById('displayFeeAmount').innerText = "+$0.00";
        }

        document.getElementById('displayFinalPrice').innerText = grandRetailBase > 0 ? formatMoney(totalFinalPrice) : "$0.00";
        document.getElementById('displayDue').innerText = grandRetailBase > 0 ? formatMoney(amountDue) : "$0.00";
        document.getElementById('displayBalance').innerText = grandRetailBase > 0 ? formatMoney(balance) : "$0.00";
        
        // Populate Finance Display breakdown
        document.getElementById('displayBaseBalance').innerText = formatMoney(balance);
        document.getElementById('displayFinanceFee').innerText = formatMoney(financeFeeAmount);
        document.getElementById('displayTotalFinanced').innerText = formatMoney(totalFinancedAmount);
        
        // Handle Monthly Payment display logic
        if (financeSelect.value === "-1" || paymentMethod !== 'finance') {
            document.getElementById('displayMonthly').innerText = "$0.00";
        } else if (grandRetailBase > 0 && pfRate > 0) {
            document.getElementById('displayMonthly').innerText = formatMoney(monthly) + " /mo";
        } else if (grandRetailBase > 0 && pfRate === 0 && selectedOption.innerText.includes("SAC")) {
            document.getElementById('displayMonthly').innerText = "$0.00 /mo (During Promo)";
        } else if (grandRetailBase > 0 && pfRate === 0) {
            document.getElementById('displayMonthly').innerText = "$0.00 /mo";
        }
    }
</script>

</body>
</html>
